# 个人工作说明

## 概述

- 实现程序架构搭建和基础功能实现，包括运动逻辑、图像绘制、音效播放、碰撞检测、触控监听、流程控制
- JAVA代码量：有效行数1100左右

## 类结构

- **MainActivity** 游戏入口，通过按钮事件进入游戏。
- **GameActivity** 进入游戏后的界面，主要部分是一个GameView。
- **GameView** 继承自View，实现游戏流程控制、画面绘制、触控监听、音效播放。
- **Sprite** 游戏物体基类，实现坐标记录、在Canvas上绘制位图、碰撞检测。
  - **Character** 人物类，实现动态绘制、跳跃、发射子弹、与地面交互、与道具和敌人交互。
  - **Background** 背景类，通过不断更新锚点拼接绘制，实现循环滚动。
  - **Bullet** 子弹类，生成后持续向屏幕右侧位移，击中目标或超出屏幕范围销毁自身。
  - **Explosion** 爆炸类，通过与Character类似的方式绘制爆炸动画。
  - **LeftMovingSprite** 该类依据GameView中设定的速度不断向屏幕左侧移动，超出屏幕范围销毁自身。
    - **Floor** 地面类，在GameView中随机设定长度和高度。
    - **GameObject** 可交互物体类，随机生成后与Floor绑定，同时以随机生成的参数左右或上下移动。
      - **Potion** 道具类，与Character碰撞后销毁自身，同时增加分数、产生增益效果。
        - **Coin** 金币类，增加分数。
        - **Gun** 武器类，使Character在一段时间内发射Bullet。
      - **Monster** 怪物类，与Bullet碰撞减少生命值，减为0后销毁自身；与Character会减少对方生命值。

## 绘制图像

- 每个Sprite存储一个Bitmap，并实现draw()方法，根据当前坐标在Canvas上绘制图像，并更新物体状态。
- 对于动态图像，每次绘制时选取的是Bitmap的一部分，每隔一定帧数更新为下一部分，最终实现类似GIF的动态效果。

- GameView存储了当前游戏中所有Sprite，并重写View的onDraw()方法，每一帧中首先删除已被销毁的Sprite，然后按照顺序依次将Sprite绘制在Canvas上。

## 播放音效

- SoundPool不需要单独建立Service，适合本项目简单的音效播放任务。
- 在SoundPool中载入全部音频，并通过重写onLoadComplete()方法监测载入完成情况，载入完成后即可通过play()和pause()方法进行音效播放和停止。
- 对于背景音乐，游戏开始后循环播放，游戏暂停或人物死亡后暂停播放；对于其他音效，在对应事件被触发时播放一次。

## 碰撞检测

- Sprite中存储了锚点坐标和图像长宽，由此得出物体的碰撞矩形，通过两个矩形相交判断碰撞。
- 图像可能存在边框，直接计算矩形容易使玩家出现误判，因此设定一个碰撞偏移量对矩形大小进行调整。对道具类设为正值，增加矩形大小，使玩家更容易碰撞道具；对怪物类设为负值，减小矩形大小，使玩家更难碰撞怪物。

## 触控监听

- GameView重写View的onTouchEvent()方法，实现对单击事件的监听。并通过触点坐标和当前游戏状态，判断事件会触发哪种效果。

## 游戏流程控制

- 设置Run、Pause、Over三个状态，GameView每次进行绘制时，依据当前状态绘制不同界面。
- Run状态绘制动态进行的游戏，左上角绘制暂停按钮。监听到按下暂停按钮后切换为Pause状态，人物死亡后切换到Over状态。
- Pause和Over状态静态绘制上一帧游戏画面，并绘制一个分数对话框，按下“继续”/“重新开始”按钮后切换到Run状态。
